function pyramidBuilder(G,F,v,x,C){var r=typeof x==="undefined"?400:x,B=typeof v==="undefined"?400:v;var u={top:50,right:10,bottom:20,left:10,middle:20},c=r/2-u.middle,i=c,j=r-c;var C={leftBarColor:typeof C.leftBarColor==="undefined"?"#6c9dc6":C.leftBarColor,rightBarColor:typeof C.rightBarColor==="undefined"?"#de5454":C.rightBarColor,tooltipBG:typeof C.tooltipBG==="undefined"?"#fefefe":C.tooltipBG,tooltipColor:typeof C.tooltipColor==="undefined"?"black":C.tooltipColor};var p=d3.sum(G,function(h){return h.male+h.female}),t=function(h){return h/p};var y=d3.select(F).append("style").text(".axis line,axis path {shape-rendering: crispEdges;fill: transparent;stroke: #555;}     .axis text {font-size: 11px;}     .bar {fill-opacity: 0.5;}     .bar.left {fill: "+C.leftBarColor+";}     .bar.left:hover {fill: "+E(C.leftBarColor,"333333")+";}     .bar.right {fill: "+C.rightBarColor+";}     .bar.right:hover {fill: "+E(C.rightBarColor,"333333")+";}     .tooltip {position: absolute;line-height: 1.1em;padding: 7px; margin: 3px;background: "+C.tooltipBG+"; color: "+C.tooltipColor+"; pointer-events: none;border-radius: 6px;}");var g=d3.select(F).append("svg").attr("width",u.left+r+u.right).attr("height",u.bottom+B+u.top);var a=g.append("g").attr("class","legend");a.append("rect").attr("class","bar left").attr("x",(r/2)-(u.middle*3)).attr("y",12).attr("width",12).attr("height",12);a.append("text").attr("fill","#000").attr("x",(r/2)-(u.middle*2)).attr("y",18).attr("dy","0.32em").text("Males");a.append("rect").attr("class","bar right").attr("x",(r/2)+(u.middle*2)).attr("y",12).attr("width",12).attr("height",12);a.append("text").attr("fill","#000").attr("x",(r/2)+(u.middle*3)).attr("y",18).attr("dy","0.32em").text("Females");var m=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);var o=g.append("g").attr("class","inner-region").attr("transform",n(u.left,u.top));var D=Math.max(d3.max(G,function(h){return t(h.male)}),d3.max(G,function(h){return t(h.female)}));var H=d3.scaleLinear().domain([0,D]).range([0,c]).nice();var d=d3.scaleLinear().domain([0,D]).range([c,0]);var q=d3.scaleLinear().domain([0,D]).range([0,c]);var b=d3.scaleBand().domain(G.map(function(h){return h.age})).range([B,0],0.1);var f=d3.axisRight().scale(b).tickSize(4,0).tickPadding(u.middle-4);var e=d3.axisLeft().scale(b).tickSize(4,0).tickFormat("");var A=d3.axisBottom().scale(H).tickFormat(d3.format(".0%"));var z=d3.axisBottom().scale(H.copy().range([i,0])).tickFormat(d3.format(".0%"));var l=o.append("g").attr("transform",n(i,0)+"scale(-1,1)");var k=o.append("g").attr("transform",n(j,0));o.append("g").attr("class","axis y left").attr("transform",n(i,0)).call(f).selectAll("text").style("text-anchor","middle");o.append("g").attr("class","axis y right").attr("transform",n(j,0)).call(e);o.append("g").attr("class","axis x left").attr("transform",n(0,B)).call(z);o.append("g").attr("class","axis x right").attr("transform",n(j,B)).call(A);l.selectAll(".bar.left").data(G).enter().append("rect").attr("class","bar left").attr("x",0).attr("y",function(h){return b(h.age)+u.middle/4}).attr("width",function(h){return H(t(h.male))}).attr("height",(b.range()[0]/G.length)-u.middle/2).on("mouseover",function(h){m.transition().duration(200).style("opacity",0.9);m.html("<strong>Males Age "+h.age+"</strong><br />  Population: "+s(h.male)+"<br />"+(Math.round(t(h.male)*1000)/10)+"% of Total").style("left",(d3.event.pageX)+"px").style("top",(d3.event.pageY-28)+"px")}).on("mouseout",function(h){m.transition().duration(500).style("opacity",0)});k.selectAll(".bar.right").data(G).enter().append("rect").attr("class","bar right").attr("x",0).attr("y",function(h){return b(h.age)+u.middle/4}).attr("width",function(h){return H(t(h.female))}).attr("height",(b.range()[0]/G.length)-u.middle/2).on("mouseover",function(h){m.transition().duration(200).style("opacity",0.9);m.html("<strong> Females Age "+h.age+"</strong><br />  Population: "+s(h.male)+"<br />"+(Math.round(t(h.male)*1000)/10)+"% of Total").style("left",(d3.event.pageX)+"px").style("top",(d3.event.pageY-28)+"px")}).on("mouseout",function(h){m.transition().duration(500).style("opacity",0)});function n(h,w){return"translate("+h+","+w+")"}function s(h){return h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function E(I,w){var I=I.replace("#","");origHex={r:I.substring(0,2),g:I.substring(2,4),b:I.substring(4,6)},transVec={r:w.substring(0,2),g:w.substring(2,4),b:w.substring(4,6)},newHex={};function h(L,K){var J=parseInt(L,16)+parseInt(K,16);if(J>255){J=255}return J.toString(16)}newHex.r=h(origHex.r,transVec.r);newHex.g=h(origHex.g,transVec.g);newHex.b=h(origHex.b,transVec.b);return"#"+newHex.r+newHex.g+newHex.b}};
function pyramidBuilder(I,H,v,y,E){var r=typeof y==="undefined"?400:y,D=typeof v==="undefined"?400:v,x=r,B=D;if(r>$(window).width()){r=$(window).width()}var u={top:50,right:10,bottom:20,left:10,middle:20},r=(r-((u.middle*2)+u.right)),D=(D-(u.top+u.bottom)),c=r/2-u.middle,i=c,j=r-c;var E={leftBarColor:typeof E.leftBarColor==="undefined"?"#6c9dc6":E.leftBarColor,rightBarColor:typeof E.rightBarColor==="undefined"?"#de5454":E.rightBarColor,tooltipBG:typeof E.tooltipBG==="undefined"?"#fefefe":E.tooltipBG,tooltipColor:typeof E.tooltipColor==="undefined"?"black":E.tooltipColor};var p=d3.sum(I,function(h){return h.male+h.female}),t=function(h){return h/p};var z=d3.select(H).append("style").text("svg {max-width:100%}     .axis line,axis path {shape-rendering: crispEdges;fill: transparent;stroke: #555;}     .axis text {font-size: 11px;}     .bar {fill-opacity: 0.5;}     .bar.left {fill: "+E.leftBarColor+";}     .bar.left:hover {fill: "+G(E.leftBarColor,"333333")+";}     .bar.right {fill: "+E.rightBarColor+";}     .bar.right:hover {fill: "+G(E.rightBarColor,"333333")+";}     .tooltip {position: absolute;line-height: 1.1em;padding: 7px; margin: 3px;background: "+E.tooltipBG+"; color: "+E.tooltipColor+"; pointer-events: none;border-radius: 6px;}");var g=d3.select(H).append("svg").attr("width",x).attr("height",B);var a=g.append("g").attr("class","legend");a.append("rect").attr("class","bar left").attr("x",(r/2)-(u.middle*3)).attr("y",12).attr("width",12).attr("height",12);a.append("text").attr("fill","#000").attr("x",(r/2)-(u.middle*2)).attr("y",18).attr("dy","0.32em").text("Males");a.append("rect").attr("class","bar right").attr("x",(r/2)+(u.middle*2)).attr("y",12).attr("width",12).attr("height",12);a.append("text").attr("fill","#000").attr("x",(r/2)+(u.middle*3)).attr("y",18).attr("dy","0.32em").text("Females");var m=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);var o=g.append("g").attr("class","inner-region").attr("transform",n(u.left,u.top));var F=Math.max(d3.max(I,function(h){return t(h.male)}),d3.max(I,function(h){return t(h.female)}));var J=d3.scaleLinear().domain([0,F]).range([0,c]).nice();var d=d3.scaleLinear().domain([0,F]).range([c,0]);var q=d3.scaleLinear().domain([0,F]).range([0,c]);var b=d3.scaleBand().domain(I.map(function(h){return h.age})).range([D,0],0.1);var f=d3.axisRight().scale(b).tickSize(4,0).tickPadding(u.middle-4);var e=d3.axisLeft().scale(b).tickSize(4,0).tickFormat("");var C=d3.axisBottom().scale(J).tickFormat(d3.format(".0%"));var A=d3.axisBottom().scale(J.copy().range([i,0])).tickFormat(d3.format(".0%"));var l=o.append("g").attr("transform",n(i,0)+"scale(-1,1)");var k=o.append("g").attr("transform",n(j,0));o.append("g").attr("class","axis y left").attr("transform",n(i,0)).call(f).selectAll("text").style("text-anchor","middle");o.append("g").attr("class","axis y right").attr("transform",n(j,0)).call(e);o.append("g").attr("class","axis x left").attr("transform",n(0,D)).call(A);o.append("g").attr("class","axis x right").attr("transform",n(j,D)).call(C);l.selectAll(".bar.left").data(I).enter().append("rect").attr("class","bar left").attr("x",0).attr("y",function(h){return b(h.age)+u.middle/4}).attr("width",function(h){return J(t(h.male))}).attr("height",(b.range()[0]/I.length)-u.middle/2).on("mouseover",function(h){m.transition().duration(200).style("opacity",0.9);m.html("<strong>Males Age "+h.age+"</strong><br />  Population: "+s(h.male)+"<br />"+(Math.round(t(h.male)*1000)/10)+"% of Total").style("left",(d3.event.pageX)+"px").style("top",(d3.event.pageY-28)+"px")}).on("mouseout",function(h){m.transition().duration(500).style("opacity",0)});k.selectAll(".bar.right").data(I).enter().append("rect").attr("class","bar right").attr("x",0).attr("y",function(h){return b(h.age)+u.middle/4}).attr("width",function(h){return J(t(h.female))}).attr("height",(b.range()[0]/I.length)-u.middle/2).on("mouseover",function(h){m.transition().duration(200).style("opacity",0.9);m.html("<strong> Females Age "+h.age+"</strong><br />  Population: "+s(h.male)+"<br />"+(Math.round(t(h.male)*1000)/10)+"% of Total").style("left",(d3.event.pageX)+"px").style("top",(d3.event.pageY-28)+"px")}).on("mouseout",function(h){m.transition().duration(500).style("opacity",0)});function n(h,w){return"translate("+h+","+w+")"}function s(h){return h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function G(K,w){var K=K.replace("#","");origHex={r:K.substring(0,2),g:K.substring(2,4),b:K.substring(4,6)},transVec={r:w.substring(0,2),g:w.substring(2,4),b:w.substring(4,6)},newHex={};function h(N,M){var L=parseInt(N,16)+parseInt(M,16);if(L>255){L=255}return L.toString(16)}newHex.r=h(origHex.r,transVec.r);newHex.g=h(origHex.g,transVec.g);newHex.b=h(origHex.b,transVec.b);return"#"+newHex.r+newHex.g+newHex.b}};